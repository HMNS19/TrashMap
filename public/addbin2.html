<!DOCTYPE html>
<html>
  <head>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        background-color: #c9d6ff;
        background: linear-gradient(to right, #e2e2e2, #c9d6ff);
      }
      /* Add these styles to your home.css */
      /* Add some basic styling to the search bar and button */
      #searchInput {
        width: 250px; /* Slightly wider */
        height: 40px; /* Slightly taller */
        padding: 10px;
        font-size: 16px;
        border: 1px solid #ccc;
        border-radius: 5px; /* Rounded corners */
        box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1); /* Inner shadow */
        transition: border-color 0.3s ease, box-shadow 0.3s ease; /* Smooth transition */
      }

      #searchInput:focus {
        border-color: #4caf50; /* Green border on focus */
        box-shadow: 0 0 5px rgba(76, 175, 80, 0.5); /* Green glow on focus */
        outline: none; /* Remove default outline */
      }

      #searchBtn {
        height: 40px; /* Match input height */
        padding: 0 20px; /* Horizontal padding */
        font-size: 16px;
        border: none;
        border-radius: 5px;
        background-color: #4caf50;
        color: #fff;
        cursor: pointer;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); /* Subtle shadow */
        transition: background-color 0.3s ease, transform 0.3s ease; /* Smooth transition */
      }

      #searchBtn:hover {
        background-color: #3e8e41;
        transform: translateY(-2px); /* Slight lift on hover */
      }

      #searchBtn:active {
        background-color: #2e7031; /* Darker green on click */
        transform: translateY(0); /* Reset lift on click */
      }
      #navbar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px 20px;
        background-color: #333;
        color: white;
      }

      .nav-links a {
        color: white;
        text-decoration: none;
        padding: 0 10px;
      }

      .nav-extras {
        display: flex;
        align-items: center;
      }

      .points-display {
        margin-right: 20px;
        font-size: 16px;
        font-weight: bold;
      }

      .download-btn {
        color: white;
        background-color: #007bff;
        padding: 10px 20px;
        border: none;
        text-decoration: none;
        border-radius: 5px;
      }

      /* Navigation Bar */
      nav {
        background-color: #333;
        color: white;
        padding: 10px 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .dropdown {
        position: relative;
        display: inline-block;
      }

      .dropdown-content {
        display: none;
        position: absolute;
        background-color: #333;
        min-width: 160px;
        box-shadow: 0px 8px 16px 0px rgba(0, 0, 0, 0.2);
        border-radius: 10px;
        padding: 8px;
        z-index: 1;
      }

      .dropdown-content a {
        color: white;
        padding: 12px 16px;
        text-decoration: none;
        display: block;
        text-align: left;
      }

      .dropdown-content a:hover {
        background-color: rgb(68, 64, 64);
      }

      .dropdown:hover .dropdown-content {
        display: block;
      }

      nav a {
        text-decoration: none;
        color: white;
        padding: 10px 15px;
        transition: background-color 0.3s ease;
      }

      nav .download-btn {
        background-color: #ff6600;
        padding: 10px 20px;
        border-radius: 5px;
      }

      .googlemap {
        margin: 0 auto;
        height: 1000px;
        width: 1000px;
      }
      .main_content {
        display: inline-block;
        height: 100px;
      }
      .infowin {
        width: 250px;
        max-height: 200px;
        padding: 5px;
        background: #ffffff;
        display: inline-block;
      }
      .infowin_img {
        float: left;
        margin: 0;
        width: 70px;
        height: 100%;
        background: #000000;
      }
      .infowin_img > img {
        height: 100%;
        width: 70px;
      }
      .infowin_content {
        float: left;
        margin: 0;
        background: #000000;
        height: 100%;
        width: 180px;
        color: white;
        padding: 5px;
        overflow: scroll;
        -moz-box-sizing: border-box;
        -webkit-box-sizing: border-box;
        box-sizing: border-box;
      }
      .btn_div {
        bottom: 0;
        width: 100%;
        margin: 0 auto;
        text-align: center;
      }
      .button {
        padding: 3px;
        width: 100px;
        color: white;
        cursor: pointer;
        border-radius: 5px;
        text-align: center;
        display: inline-block;
      }
      .edit_btn {
        border: 1px solid #277107;
        background: #2e8608;
      }
      .edit_btn:hover {
        background: #206004;
      }
      .remove_btn {
        border: 1px solid #e54646;
        border-radius: 5px;
        background: #dd5f5f;
      }
      .remove_btn:hover {
        background: #e32424;
      }
    </style>
  </head>
  <body>
    <nav>
      <div class="nav-links">
        <a href="./home.html">Home</a>
        <a href="./aboutus.html">About</a>
        <a href="./dump.html">Dumpsites</a>
        <a href="./pickup.html">Pickup</a>
        <a href="./litter.html">BlackSpot</a>
        <div class="dropdown">
          <a>Bins</a>
          <div class="dropdown-content">
            <a href="./add_Bin.html">Add a Bin</a>
            <a href="./viewbin.html">View Bins</a>
          </div>
        </div>
        <a href="./contactus.html">Contact</a>
      </div>
      <a href="./login.html" class="download-btn">Logout</a>
    </nav>
    <input type="text" id="searchInput" placeholder="Enter a location" />
    <button id="searchBtn">Search</button>

    <div id="googlemap" class="googlemap"></div>
    <div id="form" hidden>
      <table>
        <tr>
          <td>Name:</td>
          <td><input type="text" id="name" /></td>
        </tr>
        <tr>
          <td>Description:</td>
          <td><input type="text" id="description" /></td>
        </tr>
        <tr>
          <td>Image:</td>
          <td><input type="file" id="photo" /></td>
        </tr>
        <tr>
          <td></td>
          <td>
            <input
              type="button"
              value="Save"
              onclick="GoogleMap.saveLocation()"
            />
          </td>
        </tr>
      </table>
    </div>
    <div id="infowin" hidden>
      <div class="infowin">
        <div class="main_content">
          <div class="infowin_img">
            <img src="dummy.jpg" />
          </div>
          <div class="infowin_content">
            <span>PLACE_NAME</span><br />
            <span>PLACE_DESCRIPTION</span><br />
            <span>Added by : ADDED_BY</span>
          </div>
        </div>
        <div class="btn_div">
          <div class="button edit_btn" onclick="GoogleMap.editLocation()">
            Edit Location
          </div>
          <div class="button remove_btn" onclick="GoogleMap.removeLocation()">
            Remove Location
          </div>
        </div>
      </div>
    </div>
    <script>
      var CommonUtil = (function () {
        return {
          getInputValue: function (id) {
            return document.getElementById(id).value;
          },
          setInputValue: function (id, value) {
            document.getElementById(id).value = value;
          },
        };
      })();

      var GoogleMap = (function () {
        var map,
          selectedmarker,
          markers = [],
          infowindow;
        var formcontent = document.getElementById("form").innerHTML,
          detailscontent = document.getElementById("infowin").innerHTML;

        return {
          initialize: function () {
            map = new google.maps.Map(document.getElementById("googlemap"), {
              center: new google.maps.LatLng(12.971599, 77.594566), //Setting Initial Position
              zoom: 12,
            });

            // Load saved locations from localStorage
            var savedLocations =
              JSON.parse(localStorage.getItem("locations")) || [];
            savedLocations.forEach(function (loc) {
              var latlng = new google.maps.LatLng(loc.lat, loc.lng);
              var marker = new google.maps.Marker({
                position: latlng,
                map: map,
                label: markers.length + 1,
              });
              marker.placeInfo = loc.info;
              marker.addListener("click", function () {
                selectedmarker = this;
                GoogleMap.showPlaceDetailsToUser(this);
              });
              markers.push(marker);
            });

            map.addListener("click", function (event) {
              GoogleMap.addLocation(event.latLng);
            });
          },

          addLocation: function (latlng) {
            var marker = new google.maps.Marker({
              position: latlng,
              map: map,
              label: markers.length + 1,
              
            });

            marker.addListener("click", function () {
              selectedmarker = this;
              GoogleMap.showPlaceDetailsToUser(this);
            });

            GoogleMap.getPlaceDetailsFromUser(marker);
            markers.push(marker);
            selectedmarker = marker;
          },

          saveLocation: function () {
            selectedmarker.placeInfo = selectedmarker.placeInfo || {};
            selectedmarker.placeInfo.name = CommonUtil.getInputValue("name");
            selectedmarker.placeInfo.description =
              CommonUtil.getInputValue("description");
            selectedmarker.placeInfo.photo = CommonUtil.getInputValue("photo");
            selectedmarker.placeInfo.addedBy = Math.random()
              .toString(36)
              .substr(2, 5);

            GoogleMap.showPlaceDetailsToUser(selectedmarker);

            // Save locations to localStorage
            var locations = markers.map(function (marker) {
              return {
                lat: marker.getPosition().lat(),
                lng: marker.getPosition().lng(),
                info: marker.placeInfo,
              };
            });
            localStorage.setItem("locations", JSON.stringify(locations));
          },

          removeLocation: function () {
            markers.splice(markers.indexOf(selectedmarker), 1);
            if (selectedmarker) {
              selectedmarker.setMap(null);
            }
            var locations = markers.map(function (marker) {
              return {
                lat: marker.getPosition().lat(),
                lng: marker.getPosition().lng(),
                info: marker.placeInfo,
              };
            });
            localStorage.setItem("locations", JSON.stringify(locations));
          },

          editLocation: function () {
            GoogleMap.showPlaceDetailsToUser(selectedmarker, true);
            CommonUtil.setInputValue("name", selectedmarker.placeInfo.name);
            CommonUtil.setInputValue(
              "description",
              selectedmarker.placeInfo.description
            );
            CommonUtil.setInputValue("photo", selectedmarker.placeInfo.photo);
          },

          getPlaceDetailsFromUser: function (marker) {
            GoogleMap.showInfoWindow(formcontent, marker);
          },

          showPlaceDetailsToUser: function (marker, isedit) {
            var content =
              marker.placeInfo && !isedit
                ? detailscontent
                    .replace("PLACE_NAME", marker.placeInfo.name || "NO_NAME")
                    .replace(
                      "PLACE_DESCRIPTION",
                      marker.placeInfo.description || "NO_DESCRIPTION"
                    )
                    .replace("ADDED_BY", marker.placeInfo.addedBy)
                : formcontent;
            GoogleMap.showInfoWindow(content, marker);
          },

          showInfoWindow: function (content, marker) {
            if (infowindow) infowindow.close();

            infowindow = new google.maps.InfoWindow({ content: content });
            infowindow.open(map, marker);
          },
        };
      })();
      var searchInput = document.getElementById("searchInput");
      var searchBtn = document.getElementById("searchBtn");

      searchLocation = () => {
        let location = searchInput.value.trim();
        if (location) {
          // Use the Google Maps Geocoder API to get the coordinates of the location
          let geocoder = new google.maps.Geocoder();
          geocoder.geocode({ address: location }, (results, status) => {
            if (status === "OK") {
              let latLng = results[0].geometry.location;
              // Pan the map to the new location and set zoom
              GoogleMap.panToLocation(latLng);
            } else {
              alert("Unable to find location");
            }
          });
        }
      };

      // Integrate geolocation with map initialization
      navigator.geolocation.getCurrentPosition((position) => {
        const { latitude, longitude } = position.coords;
        const mapElement = document.getElementById("googlemap");

        // Initialize the Google Map using the user's current location
        GoogleMap.initialize({ lat: latitude, lng: longitude });

        // Attach the search button event listener
        searchBtn.addEventListener("click", searchLocation);
      });
    </script>
    <script
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBSJi4beLUlh5IDO7jySN7sMkqFf2RSp9Y&callback=GoogleMap.initialize"
      type="text/javascript"
      async
      defer
    ></script>
  </body>
</html>
